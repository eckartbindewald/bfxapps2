---
title: "Trees from Sequence Alignments"
author: "Eckart Bindewald"
date: "4/7/2020"
output:
  powerpoint_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

## Reconstructure Trees from Sequence Alignments

* We learned how to visualize logical trees using R package ggtree
* Sequence alignments contain information about similarities between sequences
* R function phangorn can help to create trees from alignments

## Preliminaries

```{r}
library(Biostrings)
library(msa) # BiocManager::install("msa)
library(phangorn) # install.packages("phangorn")
```

## Download Data

```{r}
remote_folder="https://raw.githubusercontent.com/PacktPublishing/R-Bioinformatics-Cookbook/master/datasets/Chapter04"
fa_file = "abc.fa"
if (!file.exists(fa_file)) {
  download.file(file.path(remote_folder,fa_file),fa_file)
}
stopifnot(file.exists(fa_file))
```

## Read in Data

```{r}
seqs <- readAAStringSet(fa_file)
aln <- msa::msa(seqs,method="ClustalOmega") # convert to alignment datastructure
```

## Create Distance Matrix

```{r}
aln <- phangorn::as.phyDat(aln, type="AA")
dist_mat <- dist.ml(aln)
upgma_tree <- upgma(dist_mat)
```

## Visualizing Distance Matrix

```{r}
image(as.matrix(dist_mat))
```

## UPGMA trees

* UPGMA: unweighted pair group method with arithmetic mean
* same as "average linkage clustering"
* Distance to a cluster of sequences is same as average of distances to individual members of that cluster

```{r}
upgma_tree <- phangorn::upgma(dist_mat)
plot(upgma_tree, main="UPGMA")
```

## Visualizing Neighbor-Joining Tree

```{r}
nj_tree <- phangorn::NJ(dist_mat)
plot(nj_tree, "unrooted", main="NJ")
```

## Bootstrapping

```{r}
bootstraps <- bootstrap.phyDat(aln, FUN=function(x){NJ(dist.ml(x))}, bs=100)
plotBS(nj_tree, bootstraps, p=10)
```
